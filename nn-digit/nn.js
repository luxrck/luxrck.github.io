window.B = [[[0.018830824633543082], [0.6095647664479078], [-4.612130575503664], [2.236864960705188], [-0.953783903417714], [-1.4257005063041137], [0.6081611953197027], [1.5956360919407322], [-2.466556940353751], [-0.4616158638479717], [-2.8610129923956475], [2.619510167195787], [-0.0316172221229073], [0.5376011185487208], [1.1799920073067764], [0.6776912783102786], [-1.209003919174787], [-3.2170350090470556], [0.19601702661649487], [-2.880854351847437], [-0.6898191418207733], [-1.3048212879111187], [-2.365019369716981], [-2.7100873087073936], [-2.1323350004214086], [3.0936764706921376], [2.369743511386539], [1.2926643323261744], [-3.8138040884498574], [0.6526085719715554]], [[-5.350692008550412], [-0.5617773476389045], [-11.023767283790455], [-5.286912943902717], [-2.880991273388977], [-4.066967204888733], [-4.8621496090777905], [-3.9023126781857065], [-6.6145584222291465], [-6.767149188971764]]];

function init_network() {
    var _B = []; var _W = [];
    for (i=0; i<window.B.length; i++) {
        _B.push(nj.float32(window.B[i]));
        _W.push(nj.float32(window.W[i]));
    }
    window.B = _B; window.W = _W;
    console.log("nn init complete.");
}

function sigmoid(z) {
    return nj.divide(1.0, nj.exp(-z).add(1.0));
}

function argmax(v) {
    a = v.selection.data;
    o = a[0];
    oi = 0;
    for (i=0; i<a.length; i++) {
        if (a[i] > o) { o = a[i]; oi = i; }
    }
    return oi;
}

function feedforward(a) {
    for (i=0; i<window.B.length; i++) {
        w = window.W[i]; b = window.B[i];
        z = w.dot(a).add(b);
        //console.log("feedforward:", w, b, a, z);
        a = nj.sigmoid(z);
    } 
    console.log(a);
    return a;
}

// NN: 748/30/10
function solve(data) {
    var a = nj.float32(data).reshape(784, 1);
    return argmax(feedforward(a));
}